gj.tree={plugins:{}},gj.tree.config={base:{params:{},autoLoad:!0,selectionType:"single",cascadeSelection:!1,dataSource:void 0,primaryKey:void 0,textField:"text",childrenField:"children",hasChildrenField:"hasChildren",imageCssClassField:"imageCssClass",imageUrlField:"imageUrl",imageHtmlField:"imageHtml",disabledField:"disabled",width:void 0,border:!1,uiLibrary:"materialdesign",iconsLibrary:"materialicons",autoGenId:1,autoGenFieldName:"autoId_b5497cc5-7ef3-49f5-a7dc-4a932e1aee4a",indentation:24,style:{wrapper:"gj-unselectable",list:"gj-list gj-list-md",item:void 0,active:"gj-list-md-active",leafIcon:void 0,border:"gj-tree-md-border"},icons:{expand:'<i class="gj-icon chevron-right" />',collapse:'<i class="gj-icon chevron-down" />'}},bootstrap:{style:{wrapper:"gj-unselectable gj-tree-bootstrap-3",list:"gj-list gj-list-bootstrap list-group",item:"list-group-item",active:"active",border:"gj-tree-bootstrap-border"},iconsLibrary:"glyphicons"},bootstrap4:{style:{wrapper:"gj-unselectable gj-tree-bootstrap-4",list:"gj-list gj-list-bootstrap",item:"list-group-item",active:"active",border:"gj-tree-bootstrap-border"},icons:{expand:'<i class="gj-icon plus" />',collapse:'<i class="gj-icon minus" />'}},materialicons:{style:{expander:"gj-tree-material-icons-expander"}},fontawesome:{style:{expander:"gj-tree-font-awesome-expander"},icons:{expand:'<i class="fa fa-plus" aria-hidden="true"></i>',collapse:'<i class="fa fa-minus" aria-hidden="true"></i>'}},glyphicons:{style:{expander:"gj-tree-glyphicons-expander"},icons:{expand:'<span class="glyphicon glyphicon-plus" />',collapse:'<span class="glyphicon glyphicon-minus" />'}}},gj.tree.events={initialized:function(e){e.triggerHandler("initialized")},dataBinding:function(e){e.triggerHandler("dataBinding")},dataBound:function(e){e.triggerHandler("dataBound")},select:function(e,t,r){return e.triggerHandler("select",[t,r])},unselect:function(e,t,r){return e.triggerHandler("unselect",[t,r])},expand:function(e,t,r){return e.triggerHandler("expand",[t,r])},collapse:function(e,t,r){return e.triggerHandler("collapse",[t,r])},enable:function(e,t){return e.triggerHandler("enable",[t])},disable:function(e,t){return e.triggerHandler("disable",[t])},destroying:function(e){return e.triggerHandler("destroying")},nodeDataBound:function(e,t,r,a){return e.triggerHandler("nodeDataBound",[t,r,a])}},gj.tree.methods={init:function(e){return gj.widget.prototype.init.call(this,e),gj.tree.methods.initialize.call(this),this.getConfig().autoLoad&&this.reload(),this},initialize:function(){var e=this.getConfig(),t=this.wrap("div");gj.core.addClasses(this.element,e.style.list),gj.core.addClasses(t,e.style.wrapper),e.width&&this.width(e.width),e.border&&gj.core.addClasses(t,e.style.border),gj.tree.events.initialized(this.element)},useHtmlDataSource:function(e,t){t.dataSource=[]},render:function(e,t){var r;return t&&("string"==typeof t&&JSON&&(t=JSON.parse(t)),r=e.getConfig(),e.setRecords(t),r.primaryKey||gj.tree.methods.genAutoId(r,t),gj.tree.methods.loadData(e)),e},filter:function(e){return e.getConfig().dataSource},genAutoId:function(e,t){let r;for(r=0;r<t.length;r++)t[r][e.autoGenFieldName]=e.autoGenId++,t[r][e.childrenField]&&t[r][e.childrenField].length&&gj.tree.methods.genAutoId(e,t[r][e.childrenField])},loadData:function(e){let t,r=e.getRecords();for(gj.tree.events.dataBinding(e),e.element.innerHTML="",t=0;t<r.length;t++)gj.tree.methods.appendNode(e,e.element,r[t],1);gj.tree.events.dataBound(e.element)},appendNode:function(e,t,r,a,n){let i,d,l,o,s,c,g,p,u,h=e.getConfig(),f=h.primaryKey?r[h.primaryKey]:r[h.autoGenFieldName],b=void 0!==r[h.hasChildrenField]&&"true"===r[h.hasChildrenField].toString().toLowerCase(),j=void 0!==r[h.disabledField]&&"true"===r[h.disabledField].toString().toLowerCase();if((d=document.createElement("li")).setAttribute("data-gj-id",f),d.setAttribute("data-gj-role","node"),gj.core.addClasses(d,h.style.item),(l=document.createElement("div")).setAttribute("data-gj-role","wrapper"),(o=document.createElement("span")).setAttribute("data-gj-role","expander"),o.setAttribute("data-gj-mode","close"),gj.core.addClasses(o,h.style.expander),(s=document.createElement("span")).setAttribute("data-gj-role","display"),s.innerHTML=r[h.textField],h.indentation&&((c=document.createElement("span")).setAttribute("data-gj-role","spacer"),c.style.width=h.indentation*(a-1)/16+"rem",l.appendChild(c)),j?gj.tree.methods.disableNode(e,d):(o.addEventListener("click",gj.tree.methods.expanderClickHandler(e)),s.addEventListener("click",gj.tree.methods.displayClickHandler(e))),l.appendChild(o),l.appendChild(s),d.appendChild(l),n?t.insertBefore(d,t.children[n-1]):t.appendChild(d),h.imageCssClassField&&r[h.imageCssClassField]?((p=document.createElement("span")).setAttribute("data-gj-role","image"),p.innerHTML='<span class="'+r[h.imageCssClassField]+'"></span>',l.insertBefore(p,s)):h.imageUrlField&&r[h.imageUrlField]?((p=document.createElement("span")).setAttribute("data-gj-role","image"),l.insertBefore(p,s),(u=document.createElement("img")).setAttribute("src",r[h.imageUrlField]),u.setAttribute("width",gj.core.width(p)),u.setAttribute("height",gj.core.height(p)),p.appendChild(u)):h.imageHtmlField&&r[h.imageHtmlField]&&((p=document.createElement("span")).setAttribute("data-gj-role","image"),p.innerHTML=r[h.imageHtmlField],l.insertBefore(p,s)),r[h.childrenField]&&r[h.childrenField].length||b){if(o.innerHTML=h.icons.expand,g=document.createElement("ul"),gj.core.addClasses(g,h.style.list+" gj-hidden"),d.appendChild(g),r[h.childrenField]&&r[h.childrenField].length)for(i=0;i<r[h.childrenField].length;i++)gj.tree.methods.appendNode(e,g,r[h.childrenField][i],a+1)}else h.style.leafIcon?gj.core.addClasses(o,h.style.leafIcon):o.innerHTML="&nbsp;";gj.tree.events.nodeDataBound(e.element,d,r.id,r)},expanderClickHandler:function(r){return function(e){var t=this.closest("li");"close"===this.getAttribute("data-gj-mode")?r.expand(t):r.collapse(t)}},expand:function(e,t,r){let a,n,i=t.querySelector('>[data-gj-role="wrapper"]>[data-gj-role="expander"]'),d=e.getConfig(),l=t.getAttribute("data-gj-id"),o=t.querySelector(">ul");if(!1!==gj.tree.events.expand(e.element,t,l)&&o&&o.length&&(o.style.display="block",i.setAttribute("data-gj-mode","open"),i.innerHTML=d.icons.collapse,r))for(a=t.querySelector(">ul>li"),n=0;n<a.length;n++)gj.tree.methods.expand(e,a[n],r);return e},collapse:function(e,t,r){let a,n,i=t.querySelector('>[data-gj-role="wrapper"]>[data-gj-role="expander"]'),d=e.getConfig(),l=t.getAttribute("data-gj-id"),o=t.children("ul");if(!1!==gj.tree.events.collapse(e,t,l)&&o&&o.length&&(o.style.display="none",i.setAttribute("data-gj-mode","close"),i.innerHTML=d.icons.expand,r))for(a=t.find('>ul>li>[data-gj-role="wrapper"]>span[data-gj-mode="open"]'),n=0;n<a.length;n++)gj.tree.methods.collapse(e,a[n],r);return e},expandAll:function(e){let t,r=e.find("ul>li");for(t=0;t<r.length;t++)gj.tree.methods.expand(e,$(r[t]),!0);return e},collapseAll:function(e){let t,r=e.querySelectorAll('>ul>li>[data-gj-role="wrapper"]>span[data-gj-mode="open"]');for(t=0;t<r.length;t++)gj.tree.methods.collapse(e,r[t],!0);return e},displayClickHandler:function(r){return function(){var e=this.closest("li"),t=r.getConfig();cascade=t.cascadeSelection,"true"===e.getAttribute("data-gj-selected")?gj.tree.methods.unselect(r,e,cascade):("single"===t.selectionType&&gj.tree.methods.unselectAll(r),gj.tree.methods.select(r,e,cascade))}},selectAll:function(e){let t,r=e.querySelectorAll("ul>li");for(t=0;t<r.length;t++)gj.tree.methods.select(e,r[t],!0);return e},select:function(e,t,r){let a,n,i=e.getConfig();if("true"!==t.getAttribute("data-gj-selected")&&!1!==gj.tree.events.select(e,t,t.getAttribute("data-gj-id"))&&(t.addClass(i.style.active).attr("data-gj-selected","true"),r))for(n=t.querySelectorAll("ul>li"),a=0;a<n.length;a++)gj.tree.methods.select(e,$(n[a]),r)},unselectAll:function(e){let t,r=e.querySelectorAll(">ul>li");for(t=0;t<r.length;t++)gj.tree.methods.unselect(e,r[t],!0);return e},unselect:function(e,t,r){let a,n,i=e.getConfig();if("true"===t.getAttribute("data-gj-selected")&&!1!==gj.tree.events.unselect(e,t,t.getAttribute("data-gj-id"))&&(gj.core.removeClasses(t,i.style.active),t.removeAttribute("data-gj-selected"),r))for(n=t.querySelectorAll(">ul>li"),a=0;a<n.length;a++)gj.tree.methods.unselect(e,n[a],r)},getSelections:function(e){let t,r,a,n=[],i=e.children;if(i&&i.length)for(t=0;t<i.length;t++)"true"===(r=$(i[t])).getAttribute("data-gj-selected")?n.push(r.getAttribute("data-gj-id")):r.has("ul")&&(a=gj.tree.methods.getSelections(r.querySelector(">ul"))).length&&(n=n.concat(a));return n},getDataById:function(e,t,r){let a,n=e.getConfig(),i=void 0;for(a=0;a<r.length;a++){if(n.primaryKey&&r[a][n.primaryKey]==t){i=r[a];break}if(r[a][n.autoGenFieldName]==t){i=r[a];break}if(r[a][n.childrenField]&&r[a][n.childrenField].length&&(i=gj.tree.methods.getDataById(e,t,r[a][n.childrenField])))break}return i},getDataByText:function(e,t,r){let a,n=void 0,i=e.getConfig();for(a=0;a<r.length;a++){if(t===r[a][i.textField]){n=r[a];break}if(r[a][i.childrenField]&&r[a][i.childrenField].length&&(n=gj.tree.methods.getDataByText(e,t,r[a][i.childrenField])))break}return n},getNodeById:function(e,t){let r,a,n=void 0,i=e.children("li");if(i&&i.length)for(r=0;r<i.length;r++){if(t==(a=$(i[r])).getAttribute("data-gj-id")){n=a;break}if(a.has("ul")&&(n=gj.tree.methods.getNodeById(a.querySelector(">ul"),t)))break}return n},getNodeByText:function(e,t){let r,a,n=void 0,i=e.children("li");if(i&&i.length)for(r=0;r<i.length;r++){if(t===(a=$(i[r])).querySelector('>[data-gj-role="wrapper"]>[data-gj-role="display"]').innerText){n=a;break}if(a.has("ul")&&(n=gj.tree.methods.getNodeByText(a.querySelector(">ul"),t)))break}return n},addNode:function(e,t,r,a){var n,i=e.getConfig();return r&&r.length?("li"===r[0].tagName.toLowerCase()&&(0===r.querySelectorAll(">ul").length&&(r.querySelector('[data-gj-role="expander"]').innerHTML=i.icons.collapse,r.appendChild(gj.core.addClasses(document.createElement("ul"),i.style.list))),r=r.querySelector(">ul")),(n=e.getDataById(r.parentNode.getAttribute("data-gj-id")))[i.childrenField]||(n[i.childrenField]=[]),n[i.childrenField].push(t)):(r=e.children("ul"),e.setRecords(e.getRecords().push(t))),n=gj.tree.getLevel(r),i.primaryKey||gj.tree.methods.genAutoId(i,[t]),gj.tree.methods.appendNode(e,r,t,n,a),e},getLevel:function(e){let t=1,r=e.parentNode;for(;r&&"tree"!==r.getAttribute("data-gj-type");)t++,r=r.parentNode},remove:function(e,t){return gj.tree.methods.removeDataById(e,t.getAttribute("data-gj-id"),e.getRecords()),t.remove(),e},removeDataById:function(e,t,r){let a,n=e.getConfig();for(a=0;a<r.length;a++){if(n.primaryKey&&r[a][n.primaryKey]==t){r.splice(a,1);break}if(r[a][n.autoGenFieldName]==t){r.splice(a,1);break}r[a][n.childrenField]&&r[a][n.childrenField].length&&gj.tree.methods.removeDataById(e,t,r[a][n.childrenField])}},update:function(e,t,r){var a=e.getConfig(),n=e.getNodeById(t);e.getDataById(t);return n.querySelector('>[data-gj-role="wrapper"]>[data-gj-role="display"]').innerHTML=r[a.textField],gj.tree.events.nodeDataBound(e.element,n,t,r),e},getChildren:function(e,t,r){let a=[],n,i,r=void 0===r||r;for(i=r?t.querySelectorAll("ul li"):t.querySelectorAll(">ul>li"),n=0;n<i.length;n++)a.push(i[n].getAttribute("data-gj-id"));return a},enableAll:function(e){let t,r=e.querySelectorAll("ul>li");for(t=0;t<r.length;t++)gj.tree.methods.enableNode(e,r[t],!0);return e},enableNode:function(e,t,r){let a,n,i=t.querySelector('>[data-gj-role="wrapper"]>[data-gj-role="expander"]'),d=t.querySelector('>[data-gj-role="wrapper"]>[data-gj-role="display"]'),r=void 0===r||r;if(t.classList.remove("disabled"),i.addEventListener("click",gj.tree.methods.expanderClickHandler(e)),d.addEventListener("click",gj.tree.methods.displayClickHandler(e)),gj.tree.events.enable(e,t),r)for(n=t.querySelectorAll("ul>li"),a=0;a<n.length;a++)gj.tree.methods.enableNode(e,n[a],r)},disableAll:function(e){let t,r=e.querySelectorAll("ul>li");for(t=0;t<r.length;t++)gj.tree.methods.disableNode(e,r[t],!0);return e},disableNode:function(e,t,r){let a,n,r=(t.querySelector('>[data-gj-role="wrapper"]>[data-gj-role="expander"]'),t.querySelector('>[data-gj-role="wrapper"]>[data-gj-role="display"]'),void 0===r||r);if(t.classList.add("disabled"),gj.tree.events.disable(e.element,t),r)for(n=t.querySelectorAll("ul>li"),a=0;a<n.length;a++)gj.tree.methods.disableNode(e,n[a],r)},destroy:function(e){return e.getConfig()&&(gj.tree.events.destroying(e.element),e.xhr&&e.xhr.abort(),e.removeData(),e.removeAttribute("data-gj-type"),e.removeClass(),e.innerHTML=""),e},pathFinder:function(e,t,r,a){let n,i=!1;for(n=0;n<t.length;n++){if(t[n].id==r){i=!0;break}if(gj.tree.methods.pathFinder(e,t[n][e.childrenField],r,a)){a.push(t[n].data[e.textField]),i=!0;break}}return i}},(GijgoTree=function(e,t){var r=this,a=gj.datepicker.methods;return r.type="tree",r.element=e,r.reload=function(e){return gj.widget.prototype.reload.call(this,e)},r.render=function(e){return a.render(this,e)},r.addNode=function(e,t,r){return a.addNode(this,e,t,r)},r.removeNode=function(e){return a.remove(this,e)},r.updateNode=function(e,t){return a.update(this,e,t)},r.destroy=function(){return a.destroy(this)},r.expand=function(e,t){return a.expand(this,e,t)},r.collapse=function(e,t){return a.collapse(this,e,t)},r.expandAll=function(){return a.expandAll(this)},r.collapseAll=function(){return a.collapseAll(this)},r.getDataById=function(e){return a.getDataById(this,e,this.data("records"))},r.getDataByText=function(e){return a.getDataByText(this,e,this.data("records"))},r.getNodeById=function(e){return a.getNodeById(this.children("ul"),e)},r.getNodeByText=function(e){return a.getNodeByText(this.children("ul"),e)},r.getAll=function(){return this.data("records")},r.select=function(e){return a.select(this,e)},r.unselect=function(e){return a.unselect(this,e)},r.selectAll=function(){return a.selectAll(this)},r.unselectAll=function(){return a.unselectAll(this)},r.getSelections=function(){return a.getSelections(this.children("ul"))},r.getChildren=function(e,t){return a.getChildren(this,e,t)},r.parents=function(e){var t=[],r=this.data();return a.pathFinder(r,r.records,e,t),t.reverse()},r.enable=function(e,t){return a.enableNode(this,e,t)},r.enableAll=function(){return a.enableAll(this)},r.disable=function(e,t){return a.disableNode(this,e,t)},r.disableAll=function(){return a.disableAll(this)},"tree"!==e.attr("data-type")&&a.init.call(r,t),r}).prototype=new gj.widget,GijgoTree.constructor=gj.tree.widget,"undefined"!=typeof jQuery&&(jQuery.fn.tree=function(e){var t;if(this&&this.length){if("object"!=typeof e&&e){if((t=new GijgoTree(this,null))[e])return t[e].apply(this,Array.prototype.slice.call(arguments,1));throw"Method "+e+" does not exist."}return new GijgoTree(this,e)}}),gj.tree.plugins.checkboxes={config:{base:{checkboxes:void 0,checkedField:"checked",cascadeCheck:!0}},private:{dataBound:function(e){e.data("cascadeCheck")&&(e=e.find('li[data-role="node"]'),$.each(e,function(){var e=$(this),t=e.find('[data-role="checkbox"] input[type="checkbox"]').checkbox("state");"checked"===t&&(gj.tree.plugins.checkboxes.private.updateChildrenState(e,t),gj.tree.plugins.checkboxes.private.updateParentState(e,t))}))},nodeDataBound:function(r,a,e,n){var i,t,d,l,o;0===a.find('> [data-role="wrapper"] > [data-role="checkbox"]').length&&(i=tree.getConfig(),t=a.find('> [data-role="wrapper"] > [data-role="expander"]'),d=$('<input type="checkbox"/>'),l=$('<span data-role="checkbox"></span>').append(d),o=void 0!==n[i.disabledField]&&"true"===n[i.disabledField].toString().toLowerCase(),d=d.checkbox({uiLibrary:i.uiLibrary,iconsLibrary:i.iconsLibrary,change:function(e,t){gj.tree.plugins.checkboxes.events.checkboxChange(r,a,n,d.state())}}),o&&d.prop("disabled",!0),n[i.checkedField]&&d.state("checked"),d.on("click",function(e){var t=d.closest("li"),r=d.state();i.cascadeCheck&&(gj.tree.plugins.checkboxes.private.updateChildrenState(t,r),gj.tree.plugins.checkboxes.private.updateParentState(t,r))}),t.after(l))},updateParentState:function(e,t){var r,a,n,i=e.parent("ul").parent("li");1===i.length&&(r=e.parent("ul").parent("li").find('> [data-role="wrapper"] > [data-role="checkbox"] input[type="checkbox"]'),e=e.siblings().find('> [data-role="wrapper"] > span[data-role="checkbox"] input[type="checkbox"]'),a="checked"===t,n="unchecked"===t,t="indeterminate",$.each(e,function(){var e=$(this).checkbox("state");a&&"checked"!==e&&(a=!1),n&&"unchecked"!==e&&(n=!1)}),a&&!n&&(t="checked"),!a&&n&&(t="unchecked"),r.checkbox("state",t),gj.tree.plugins.checkboxes.private.updateParentState(i,r.checkbox("state")))},updateChildrenState:function(e,t){e=e.find('ul li [data-role="wrapper"] [data-role="checkbox"] input[type="checkbox"]');0<e.length&&$.each(e,function(){$(this).checkbox("state",t)})},update:function(e,t,r){var a=t.find('[data-role="checkbox"] input[type="checkbox"]').first();$(a).checkbox("state",r),tree.getConfig().cascadeCheck&&(gj.tree.plugins.checkboxes.private.updateChildrenState(t,r),gj.tree.plugins.checkboxes.private.updateParentState(t,r))}},public:{getCheckedNodes:function(){var t=[],e=this.find('li [data-role="checkbox"] input[type="checkbox"]');return $.each(e,function(){var e=$(this);"checked"===e.checkbox("state")&&t.push(e.closest("li").data("id"))}),t},checkAll:function(){var e=this.find('li [data-role="checkbox"] input[type="checkbox"]');return $.each(e,function(){$(this).checkbox("state","checked")}),this},uncheckAll:function(){var e=this.find('li [data-role="checkbox"] input[type="checkbox"]');return $.each(e,function(){$(this).checkbox("state","unchecked")}),this},check:function(e){return gj.tree.plugins.checkboxes.private.update(this,e,"checked"),this},uncheck:function(e){return gj.tree.plugins.checkboxes.private.update(this,e,"unchecked"),this}},events:{checkboxChange:function(e,t,r,a){return e.triggerHandler("checkboxChange",[t,r,a])}},configure:function(n){n.data("checkboxes")&&gj.checkbox&&($.extend(!0,n,gj.tree.plugins.checkboxes.public),n.on("nodeDataBound",function(e,t,r,a){gj.tree.plugins.checkboxes.private.nodeDataBound(n,t,r,a)}),n.on("dataBound",function(){gj.tree.plugins.checkboxes.private.dataBound(n)}),n.on("enable",function(e,t){t.find('>[data-role="wrapper"]>[data-role="checkbox"] input[type="checkbox"]').prop("disabled",!1)}),n.on("disable",function(e,t){t.find('>[data-role="wrapper"]>[data-role="checkbox"] input[type="checkbox"]').prop("disabled",!0)}))}},gj.tree.plugins.dragAndDrop={config:{base:{dragAndDrop:void 0,style:{dragEl:"gj-tree-drag-el gj-tree-md-drag-el",dropAsChildIcon:"gj-cursor-pointer gj-icon plus",dropAbove:"gj-tree-drop-above",dropBelow:"gj-tree-drop-below"}},bootstrap:{style:{dragEl:"gj-tree-drag-el gj-tree-bootstrap-drag-el",dropAsChildIcon:"glyphicon glyphicon-plus",dropAbove:"drop-above",dropBelow:"drop-below"}},bootstrap4:{style:{dragEl:"gj-tree-drag-el gj-tree-bootstrap-drag-el",dropAsChildIcon:"gj-cursor-pointer gj-icon plus",dropAbove:"drop-above",dropBelow:"drop-below"}}},private:{nodeDataBound:function(e,t){var r=t.children('[data-role="wrapper"]'),a=t.find('>[data-role="wrapper"]>[data-role="display"]');r.length&&a.length&&(a.on("mousedown",gj.tree.plugins.dragAndDrop.private.createNodeMouseDownHandler(e)),a.on("mousemove",gj.tree.plugins.dragAndDrop.private.createNodeMouseMoveHandler(e,t,a)),a.on("mouseup",gj.tree.plugins.dragAndDrop.private.createNodeMouseUpHandler(e)))},createNodeMouseDownHandler:function(t){return function(e){t.data("dragReady",!0)}},createNodeMouseUpHandler:function(t){return function(e){t.data("dragReady",!1)}},createNodeMouseMoveHandler:function(i,d,l){return function(e){var t,r,a,n;i.data("dragReady")&&(r=tree.getConfig(),i.data("dragReady",!1),t=l.clone().wrap('<div data-role="wrapper"/>').closest("div").wrap('<li class="'+r.style.item+'" />').closest("li").wrap('<ul class="'+r.style.list+'" />').closest("ul"),$("body").append(t),t.attr("data-role","draggable-clone").addClass("gj-unselectable").addClass(r.style.dragEl),t.find('[data-role="wrapper"]').prepend('<span data-role="indicator" />'),t.draggable({drag:gj.tree.plugins.dragAndDrop.private.createDragHandler(i,d,l),stop:gj.tree.plugins.dragAndDrop.private.createDragStopHandler(i,d,l)}),r=l.parent(),a=l.offset().top,a-=parseInt(r.css("border-top-width"))+parseInt(r.css("margin-top"))+parseInt(r.css("padding-top")),n=l.offset().left,n=(n-=parseInt(r.css("border-left-width"))+parseInt(r.css("margin-left"))+parseInt(r.css("padding-left")))-t.find('[data-role="indicator"]').outerWidth(!0),t.css({position:"absolute",top:a,left:n,width:l.outerWidth(!0)}),"true"===l.attr("data-droppable")&&l.droppable("destroy"),gj.tree.plugins.dragAndDrop.private.getTargetDisplays(i,d,l).each(function(){var e=$(this);"true"===e.attr("data-droppable")&&e.droppable("destroy"),e.droppable()}),gj.tree.plugins.dragAndDrop.private.getTargetDisplays(i,d).each(function(){var e=$(this);"true"===e.attr("data-droppable")&&e.droppable("destroy"),e.droppable()}),t.trigger("mousedown"))}},getTargetDisplays:function(e,t,r){return e.find('[data-role="display"]').not(r).not(t.find('[data-role="display"]'))},getTargetWrappers:function(e,t){return e.find('[data-role="wrapper"]').not(t.find('[data-role="wrapper"]'))},createDragHandler:function(e,t,r){var i=gj.tree.plugins.dragAndDrop.private.getTargetDisplays(e,t,r),d=gj.tree.plugins.dragAndDrop.private.getTargetWrappers(e,t),l=tree.getConfig();return function(e,t,r){var a=$(this),n=!1;i.each(function(){var e;if($(this).droppable("isOver",r))return e=a.find('[data-role="indicator"]'),l.style.dropAsChildIcon?e.addClass(l.style.dropAsChildIcon):e.text("+"),!(n=!0);a.find('[data-role="indicator"]').removeClass(l.style.dropAsChildIcon).empty()}),d.each(function(){var e,t=$(this);!n&&t.droppable("isOver",r)?(e=t.position().top+t.outerHeight()/2,r.y<e?t.addClass(l.style.dropAbove).removeClass(l.style.dropBelow):t.addClass(l.style.dropBelow).removeClass(l.style.dropAbove)):t.removeClass(l.style.dropAbove).removeClass(l.style.dropBelow)})}},createDragStopHandler:function(o,s,e){var t=gj.tree.plugins.dragAndDrop.private.getTargetDisplays(o,s,e),c=gj.tree.plugins.dragAndDrop.private.getTargetWrappers(o,s),g=tree.getConfig();return function(e,n){var i,d,l,r,a=!1;$(this).draggable("destroy").remove(),t.each(function(){var e,t=$(this);if(t.droppable("isOver",n))return d=t.closest("li"),l=s.parent("ul").parent("li"),0===(e=d.children("ul")).length&&(e=$("<ul />").addClass(g.style.list),d.append(e)),!1!==gj.tree.plugins.dragAndDrop.events.nodeDrop(o,s.data("id"),d.data("id"),e.children("li").length+1)&&(e.append(s),i=o.getDataById(s.data("id")),gj.tree.methods.removeDataById(o,s.data("id"),g.records),void 0===(r=o.getDataById(e.parent().data("id")))[g.childrenField]&&(r[g.childrenField]=[]),r[g.childrenField].push(i),gj.tree.plugins.dragAndDrop.private.refresh(o,s,d,l)),!(a=!0);t.droppable("destroy")}),a||c.each(function(){var e,t,r,a=$(this);if(a.droppable("isOver",n))return d=a.closest("li"),l=s.parent("ul").parent("li"),e=n.y<a.position().top+a.outerHeight()/2,r=s.data("id"),t=d.prevAll('li:not([data-id="'+r+'"])').length+(e?1:2),!1!==gj.tree.plugins.dragAndDrop.events.nodeDrop(o,r,d.parent("ul").parent("li").data("id"),t)&&(i=o.getDataById(s.data("id")),gj.tree.methods.removeDataById(o,s.data("id"),g.records),o.getDataById(d.parent().data("id"))[g.childrenField].splice(d.index()+(e?0:1),0,i),e?s.insertBefore(d):s.insertAfter(d),gj.tree.plugins.dragAndDrop.private.refresh(o,s,d,l)),!1;a.droppable("destroy")})}},refresh:function(e,t,r,a){var n=tree.getConfig();gj.tree.plugins.dragAndDrop.private.refreshNode(e,r),gj.tree.plugins.dragAndDrop.private.refreshNode(e,a),gj.tree.plugins.dragAndDrop.private.refreshNode(e,t),t.find('li[data-role="node"]').each(function(){gj.tree.plugins.dragAndDrop.private.refreshNode(e,$(this))}),r.children('[data-role="wrapper"]').removeClass(n.style.dropAbove).removeClass(n.style.dropBelow)},refreshNode:function(e,t){var r=t.children('[data-role="wrapper"]'),a=r.children('[data-role="expander"]'),n=r.children('[data-role="spacer"]'),i=t.children("ul"),d=tree.getConfig(),t=t.parentsUntil('[data-type="tree"]',"ul").length;i.length&&i.children().length?i.is(":visible")?a.empty().append(d.icons.collapse):a.empty().append(d.icons.expand):a.empty(),r.removeClass(d.style.dropAbove).removeClass(d.style.dropBelow),n.css("width",d.indentation*(t-1))}},public:{},events:{nodeDrop:function(e,t,r,a){return e.triggerHandler("nodeDrop",[t,r,a])}},configure:function(r){$.extend(!0,r,gj.tree.plugins.dragAndDrop.public),r.data("dragAndDrop")&&gj.draggable&&gj.droppable&&r.on("nodeDataBound",function(e,t){gj.tree.plugins.dragAndDrop.private.nodeDataBound(r,t)})}},gj.tree.plugins.lazyLoading={config:{base:{paramNames:{parentId:"parentId"},lazyLoading:!1}},private:{nodeDataBound:function(e,t,r,a){var n=tree.getConfig(),t=t.find('> [data-role="wrapper"] > [data-role="expander"]');a.hasChildren&&t.empty().append(n.icons.expand)},createDoneHandler:function(i,d){return function(e){var t,r,a,n=tree.getConfig();if((e="string"==typeof e&&JSON?JSON.parse(e):e)&&e.length){for(0===(a=d.children("ul")).length&&(a=$("<ul />").addClass(n.style.list),d.append(a)),t=0;t<e.length;t++)i.addNode(e[t],a);(r=d.find('>[data-role="wrapper"]>[data-role="expander"]')).attr("data-mode","open"),r.empty().append(n.icons.collapse),gj.tree.events.dataBound(i)}}},expand:function(e,t,r){var a=tree.getConfig(),n={},i=t.find(">ul>li");i&&i.length||"string"==typeof a.dataSource&&(n[a.paramNames.parentId]=r,i={url:a.dataSource,data:n},e.xhr&&e.xhr.abort(),e.xhr=$.ajax(i).done(gj.tree.plugins.lazyLoading.private.createDoneHandler(e,t)).fail(e.createErrorHandler()))}},public:{},events:{},configure:function(n,e,t){t.lazyLoading&&(n.on("nodeDataBound",function(e,t,r,a){gj.tree.plugins.lazyLoading.private.nodeDataBound(n,t,r,a)}),n.on("expand",function(e,t,r){gj.tree.plugins.lazyLoading.private.expand(n,t,r)}))}};